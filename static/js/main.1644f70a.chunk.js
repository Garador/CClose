(this.webpackJsonpcorona_close=this.webpackJsonpcorona_close||[]).push([[0],{17:function(e,t,a){e.exports=a(36)},23:function(e,t,a){},27:function(e){e.exports=JSON.parse("{}")},35:function(e,t,a){},36:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(14),o=a.n(c),s=a(1),i=a.n(s),l=a(2),u=a(3),h=a(4),d=a(8),m=a(6),p=a(5),f=a(7),v=(a(23),a(15)),g=a(10),b=a(16),w=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,[{key:"getWithKey",value:function(){var e=Object(l.a)(i.a.mark((function e(t,a){var n,r=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){r.db.transaction("r",r.db[t],Object(l.a)(i.a.mark((function c(){var o;return i.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,a(r.db[t]);case 3:o=c.sent,e(o),c.next=10;break;case 7:c.prev=7,c.t0=c.catch(0),n(c.t0);case 10:case"end":return c.stop()}}),c,null,[[0,7]])}))))}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"storeWithKey",value:function(){var e=Object(l.a)(i.a.mark((function e(t,a){var n,r=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){r.db.transaction("rw",r.db[t],Object(l.a)(i.a.mark((function c(){var o;return i.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,r.db[t].add(a);case 3:o=c.sent,e(o),c.next=10;break;case 7:c.prev=7,c.t0=c.catch(0),n(c.t0);case 10:case"end":return c.stop()}}),c,null,[[0,7]])}))))}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"deleteRecords",value:function(){var e=Object(l.a)(i.a.mark((function e(t,a){var n,r=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){r.db.transaction("rw",r.db[t],Object(l.a)(i.a.mark((function c(){var o;return i.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,a(r.db[t]);case 3:o=c.sent,e(o),c.next=10;break;case 7:c.prev=7,c.t0=c.catch(0),n(c.t0);case 10:case"end":return c.stop()}}),c,null,[[0,7]])}))))}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"db",get:function(){return e.instance.db_connection||(e.instance.db_connection=new b.a("covidDatabase"),e.instance.db_connection.version(1).stores({latestData:"&link, date, values"})),e.instance.db_connection}}],[{key:"instance",get:function(){return window._db_man=window._db_man?window._db_man:new e,window._db_man}}]),e}(),E=(a(27),function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,[{key:"getLatestFile",value:function(){var e=Object(l.a)(i.a.mark((function e(){var t,a,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.FILES_LIST_URL);case 2:return t=e.sent,e.t0=JSON,e.next=6,t.text();case 6:e.t1=e.sent,a=e.t0.parse.call(e.t0,e.t1),n={download_url:""},r=a.length-1;case 10:if(!(r>0)){e.next=17;break}if(!(a[r].name.indexOf("csv")>-1)){e.next=14;break}return n=a[r],e.abrupt("break",17);case 14:r--,e.next=10;break;case 17:return e.abrupt("return",n.download_url);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"distance",value:function(e,t,a,n,r){if(e==a&&t==n)return 0;var c=Math.PI*e/180,o=Math.PI*a/180,s=t-n,i=Math.PI*s/180,l=Math.sin(c)*Math.sin(o)+Math.cos(c)*Math.cos(o)*Math.cos(i);return l>1&&(l=1),l=60*(l=180*(l=Math.acos(l))/Math.PI)*1.1515,"K"==r&&(l*=1.609344),"N"==r&&(l*=.8684),l}},{key:"hasGeoLocationActivated",value:function(){var e=Object(l.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!navigator.permissions){e.next=4;break}return e.next=3,new Promise((function(e){navigator.permissions.query({name:"geolocation"}).then((function(t){e("granted"==t.state)}))}));case 3:return e.abrupt("return",e.sent);case 4:return e.abrupt("return",null);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchDeviceLocation",value:function(){var e=Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,t){navigator.geolocation.getCurrentPosition(e,t)}));case 2:return t=e.sent,e.abrupt("return",{coords:[t.coords.latitude,t.coords.longitude],accuracy:t.coords.accuracy});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchIpLocation",value:function(){var e=Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://free.ipwhois.io/json/");case 2:return t=e.sent,e.next=5,t.json();case 5:return t=e.sent,e.abrupt("return",{coords:[t.latitude,t.longitude],accuracy:-1});case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchLocation",value:function(){var e=Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("geolocation"in navigator)){e.next=11;break}return e.prev=1,e.next=4,this.fetchDeviceLocation();case 4:return t=e.sent,e.abrupt("return",t);case 8:e.prev=8,e.t0=e.catch(1),console.log("Error getting device geolocation: ",{e:e.t0});case 11:return e.next=13,this.fetchIpLocation();case 13:return t=e.sent,e.abrupt("return",t);case 15:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"getStoredData",value:function(){var e=Object(l.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w.instance.getWithKey("latestData",(function(e){return t?e.get(t):e.orderBy("date").reverse().toArray()}));case 3:return a=e.sent,e.abrupt("return",t?a:a[0]);case 7:return e.prev=7,e.t0=e.catch(0),console.log({e:e.t0}),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"storeFetchedData",value:function(){var e=Object(l.a)(i.a.mark((function e(t,a,n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w.instance.deleteRecords("latestData",(function(e){return e.where("date").aboveOrEqual(0).delete()}));case 3:return e.next=5,w.instance.storeWithKey("latestData",{date:n,link:t,values:a});case 5:return r=e.sent,e.abrupt("return",{link_id:r});case 9:return e.prev=9,e.t0=e.catch(0),console.log({e:e.t0}),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"fetchData",value:function(){var e=Object(l.a)(i.a.mark((function e(){var t,a=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise(function(){var e=Object(l.a)(i.a.mark((function e(t){var n,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.getLatestFile();case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n=a.DEFAULT_FILE_URL;case 9:return e.next=11,a.getStoredData(n);case 11:(r=e.sent)?t(r.values):(c=n.split("/").pop().split(".")[0],c=g(c).toDate(),v.parse(n,{download:!0,complete:function(){var e=Object(l.a)(i.a.mark((function e(r){var o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.data.map((function(e,t){if(t<1)return null;var a={province_state:e[0],country_region:e[1],last_update:e[2],confirmed:parseInt(e[3]),deaths:parseInt(e[4]),recovered:parseInt(e[5]),latitude:parseFloat(e[6]),longitude:parseFloat(e[7]),report_date:c.toLocaleDateString()};return a.latitude!=a.latitude?null:a})).filter((function(e){return!!e})),e.next=3,a.storeFetchedData(n,o,c.getTime());case 3:t(o);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}));case 13:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}());case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"FILES_LIST_URL",get:function(){return"https://api.github.com/repos/CSSEGISandData/COVID-19/contents/csse_covid_19_data/csse_covid_19_daily_reports"}},{key:"DEFAULT_FILE_URL",get:function(){var e=g().subtract(1,"d").format("MM-DD-YYYY")||"03-06-2020";return"https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_daily_reports/".concat(e,".csv")}},{key:"currentDayMillis",get:function(){return new Date(g().format("MM/DD/YYYY")).getTime()}}],[{key:"instance",get:function(){return window.geo_tool_1||(window.geo_tool_1=new e),window.geo_tool_1}}]),e}()),k=a(12),y=function(e){function t(e){return Object(u.a)(this,t),Object(d.a)(this,Object(m.a)(t).call(this,e))}return Object(f.a)(t,e),Object(h.a)(t,[{key:"shareOnFb",value:function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(window.location.href),"_blank")}},{key:"getTwitterShareURL",value:function(){return"https://twitter.com/intent/tweet?text="+encodeURIComponent("How close are you from the CoronaVirus reported cases? Get the answer on: "+window.location.href)}},{key:"getShareWhatsappLink",value:function(){var e="whatsapp://send?text=How close are you from the CoronaVirus reported cases? Get the answer on: "+window.location.href;return r.a.createElement("a",{href:e,"data-action":"share/whatsapp/share",className:"button",style:{backgroundColor:"#1EBEA5",color:"white",fontWeight:"bold"}},"Whatsapp")}},{key:"render",value:function(){return r.a.createElement("header",{className:"sticky"},r.a.createElement("a",{href:"./",className:"logo"},r.a.createElement("b",null,"CClose")),r.a.createElement("label",{htmlFor:"modal-control",className:"button"},"Share"),r.a.createElement("a",{href:"mailto:azolotdev@gmail.com",className:"button"},"Contact"),r.a.createElement("input",{type:"checkbox",id:"modal-control",className:"modal"}),r.a.createElement("div",null,r.a.createElement("div",{className:"card"},r.a.createElement("label",{htmlFor:"modal-control",className:"modal-close"}),r.a.createElement("h3",{className:"section",style:{paddingBottom:"1em"}},"Share via"),r.a.createElement("a",{className:"button",href:this.getTwitterShareURL(),style:{backgroundColor:"#1DA1F2",color:"white",fontWeight:"bold"}},"Twitter"),this.getShareWhatsappLink(),r.a.createElement("button",{className:"button",onClick:this.shareOnFb,style:{backgroundColor:"#3C5A9A",color:"white",fontWeight:"bold"}},"Facebook"))))}}]),t}(r.a.Component),_=function(e){function t(e){return Object(u.a)(this,t),Object(d.a)(this,Object(m.a)(t).call(this,e))}return Object(f.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return r.a.createElement(k.Helmet,null,r.a.createElement("meta",{charSet:"utf-8"}),r.a.createElement("title",null,"CClose: Closes CoronaVirus case"),r.a.createElement("link",{rel:"canonical",href:"./"}),r.a.createElement("link",{rel:"icon",type:"image/png",href:"./virus_icon.png",sizes:"16x16"}),r.a.createElement("meta",{name:"description",content:"Closes Coronavirus to your location. Daily report"}))}}]),t}(r.a.Component),x=(a(35),function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).state={cases:[],closest:null,loading:!1,error:null,geolocationPermission:null,paging:{skip:0,limit:10}},a.loadData=a.loadData.bind(Object(p.a)(a)),a.loadGeoPermissionStatus=a.loadGeoPermissionStatus.bind(Object(p.a)(a)),a.pageUp=a.pageUp.bind(Object(p.a)(a)),a.pageDown=a.pageDown.bind(Object(p.a)(a)),a.loadGeoPermissionStatus().then((function(){console.log("--- 1"),a.loadData()})).catch((function(e){console.log("--- 2"),console.log({err:e})})),a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"loadGeoPermissionStatus",value:function(){var e=Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E.instance.hasGeoLocationActivated();case 3:t=e.sent,this.setState({geolocationPermission:t}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log({err:e.t0}),this.setState({geolocationPermission:null});case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadData",value:function(){var e=Object(l.a)(i.a.mark((function e(){var t,a,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new E,this.setState({loading:!0}),e.prev=2,e.next=5,Promise.all([t.fetchData(),t.fetchLocation()]);case 5:a=e.sent,n=a[0],r=a[1],n=n.map((function(e){var a=t.distance(r.coords[0],r.coords[1],e.latitude,e.longitude,"K");return e.distance_from_user=Math.round(100*a)/100,e})).sort((function(e,t){return e.distance_from_user>t.distance_from_user?1:e.distance_from_user<t.distance_from_user?-1:0})),this.setState({cases:n,closest:n[0],loading:!1}),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.log({e:e.t0}),this.setState({loading:!1,error:e.t0});case 16:case"end":return e.stop()}}),e,this,[[2,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"pageUp",value:function(){var e=0;this.state.paging.skip+this.state.paging.limit>=this.state.cases.length-1?e=this.state.cases.length-this.state.paging.limit:(e=this.state.paging.skip+this.state.paging.limit,this.setState({paging:{skip:e,limit:this.state.paging.limit}}))}},{key:"pageDown",value:function(){var e=0;this.state.paging.skip<=0?e=0:(e=this.state.paging.skip-this.state.paging.limit,this.setState({paging:{skip:e,limit:this.state.paging.limit}}))}},{key:"getAuthorizedScreen",value:function(){var e=this.state.cases.filter((function(e,t){return t>1})).map((function(e,t){return r.a.createElement("tr",{key:"LAT=".concat(e.latitude,";LONG=").concat(e.longitude,";").concat(t)},r.a.createElement("td",{"data-label":"Location"},e.country_region," ",r.a.createElement("small",null,e.province_state)),r.a.createElement("td",{"data-label":"Distance Away"},e.distance_from_user," km"),r.a.createElement("td",{"data-label":"Confirmed"},e.confirmed),r.a.createElement("td",{"data-label":"Deaths"},e.deaths),r.a.createElement("td",{"data-label":"Recovered"},e.recovered))})).slice(this.state.paging.skip,this.state.paging.skip+this.state.paging.limit);console.log({"this.state.paging":this.state.paging});var t="";return this.state.closest&&(t=r.a.createElement("div",{className:"card black",style:{maxWidth:"100%"}},r.a.createElement("h2",{style:{textAlign:"center"}},this.state.closest.distance_from_user," km ",r.a.createElement("small",{style:{color:"white"}},this.state.closest.country_region," ",this.state.closest.province_state?"-"+this.state.closest.province_state:"")),r.a.createElement("div",null,r.a.createElement("p",null,"Confirmed: ",this.state.closest.confirmed),r.a.createElement("p",null,"Deaths: ",this.state.closest.deaths),r.a.createElement("p",null,"Recovered: ",this.state.closest.recovered)))),r.a.createElement("div",{className:"App"},r.a.createElement(y,null),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-sm-12"},r.a.createElement("h1",null,"CC: CoronaClose",r.a.createElement("small",null,"How close are you from the ",r.a.createElement("span",{style:{color:"red"}},"Corona VID-19")," cases?")),r.a.createElement("h2",null,"Closest case to you (at ",this.state.closest.report_date,")"),r.a.createElement("small",null,r.a.createElement("a",{href:"https://github.com/CSSEGISandData/COVID-19"},"Information Source")))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-sm-12 col-md-12 col-lg-6"},t||""),r.a.createElement("div",{className:"col-sm-12 col-md-12 col-lg-6"},r.a.createElement("h3",null,"Next Closest Cases"),r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Location"),r.a.createElement("th",null,"Distance"),r.a.createElement("th",null,"Confirmed"),r.a.createElement("th",null,"Deaths"),r.a.createElement("th",null,"Recovered"))),r.a.createElement("tbody",null,e)),r.a.createElement("div",{className:"paging"},r.a.createElement("div",null,r.a.createElement("span",{className:"button",onClick:this.pageDown},"Back")),r.a.createElement("div",null,r.a.createElement("span",{className:"button",onClick:this.pageUp},"Forth"))))),r.a.createElement("footer",{className:"footer"},r.a.createElement("div",null,r.a.createElement("h3",null,"Links of interest"),r.a.createElement("a",{href:"https://www.who.int/health-topics/coronavirus",title:"World Health Organization"},"WHO")))))}},{key:"getNotLoadedScreen",value:function(){return r.a.createElement("div",{className:"row",style:{justifyContent:"center"}},r.a.createElement("div",{className:"card",style:{textAlign:"center"}},r.a.createElement("h1",null,"Note: You must enable location in order to get the data"),r.a.createElement("button",{className:"button",onClick:this.loadData},"Begin")))}},{key:"getLoadingScreen",value:function(){return r.a.createElement("div",{className:"row",style:{justifyContent:"center"}},r.a.createElement("div",{className:"col-sm-12"},r.a.createElement("h1",null,"Loading...")))}},{key:"getErrorScreen",value:function(){return r.a.createElement("div",{className:"row",style:{justifyContent:"center"}},r.a.createElement("div",{className:"col-sm-12"},r.a.createElement("h1",null,"An error has occurred. Please try again later and try cleaning your browser cache."),r.a.createElement("button",{className:"button",onClick:this.loadData},"Try Again")))}},{key:"render",value:function(){return this.state.closest?r.a.createElement("div",null,r.a.createElement(_,null),this.getAuthorizedScreen()):this.state.loading?r.a.createElement("div",null,r.a.createElement(_,null),this.getLoadingScreen()):this.state.error?r.a.createElement("div",null,r.a.createElement(_,null),this.getErrorScreen()):r.a.createElement("div",{className:"palette"},r.a.createElement(_,null),this.getLoadingScreen())}}]),t}(r.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(x,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[17,1,2]]]);
//# sourceMappingURL=main.1644f70a.chunk.js.map